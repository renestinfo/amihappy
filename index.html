<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Am I Happy Today?</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background-color: #f0f2f5;
            overflow: hidden;
            cursor: none;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 2rem;
            font-size: 3rem;
            text-align: center;
        }

        .answer {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 1rem 0;
            text-align: center;
        }

        .market-info {
            margin-top: 1rem;
            color: #666;
            font-size: 1.2rem;
            text-align: center;
        }

        .really-happy-section {
            margin-top: 3rem;
            text-align: center;
        }

        .really-happy-title {
            font-size: 2rem;
            color: #1a1a1a;
            margin-bottom: 1rem;
        }

        .ticker-input {
            padding: 0.75rem 1rem;
            font-size: 1.2rem;
            border: 2px solid #ccc;
            border-radius: 5px;
            text-transform: uppercase;
            text-align: center;
            width: 150px;
        }

        .really-happy-answer {
            font-size: 2.5rem;
            font-weight: bold;
            margin-top: 1rem;
        }

        .cursor {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 2rem;
            transform: translate(-50%, -50%);
            will-change: transform;
        }

        .other-cursor {
            position: fixed;
            pointer-events: none;
            font-size: 2rem;
            transform: translate(-50%, -50%);
            will-change: transform;
        }
    </style>
</head>
<body>
    <h1>Am I Happy Today?</h1>
    <div id="answer" class="answer">Loading...</div>
    <div id="marketInfo" class="market-info">Checking S&P 500...</div>
    
    <div class="really-happy-section">
        <h2 class="really-happy-title">Am I Really Happy?</h2>
        <input type="text" id="tickerInput" class="ticker-input" placeholder="Ticker" maxlength="10">
        <div id="reallyHappyAnswer" class="really-happy-answer"></div>
    </div>
    
    <div id="myCursor" class="cursor">üòê</div>

    <script>
        const cursor = document.getElementById('myCursor');
        const answer = document.getElementById('answer');
        const marketInfo = document.getElementById('marketInfo');
        const tickerInput = document.getElementById('tickerInput');
        const reallyHappyAnswer = document.getElementById('reallyHappyAnswer');
        const otherCursors = new Map();
        const proximityThreshold = 150;
        let isMarketPositive = false;
        let lastCheckTime = 0;
        const checkInterval = 50;

        document.addEventListener('mousemove', (e) => {
            requestAnimationFrame(() => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
                
                const now = Date.now();
                if (now - lastCheckTime >= checkInterval) {
                    checkProximity(e.clientX, e.clientY);
                    lastCheckTime = now;
                }
            });
        });

        function checkProximity(x, y) {
            let isNearOther = false;

            otherCursors.forEach((otherCursor) => {
                const dx = x - otherCursor.x;
                const dy = y - otherCursor.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < proximityThreshold) {
                    isNearOther = true;
                    otherCursor.element.textContent = 'üòä';
                } else {
                    otherCursor.element.textContent = isMarketPositive ? 'ü§î' : 'üòü';
                }
            });

            cursor.textContent = isNearOther ? 'üòä' : (isMarketPositive ? 'ü§î' : 'üòü');
        }

        async function checkMarket() {
            try {
                const response = await fetch('./spy.json', { cache: 'no-store' });
                const data = await response.json();
                
                // Finnhub quote format: { c: current, pc: previous close, ... }
                const changePercent = ((data.c - data.pc) / data.pc) * 100;
                isMarketPositive = changePercent >= 0;
                
                answer.textContent = isMarketPositive ? 'YES! üòä' : 'NO üòü';
                answer.style.color = isMarketPositive ? '#22c55e' : '#ef4444';
                marketInfo.textContent = `SPY is ${isMarketPositive ? 'up' : 'down'} ${Math.abs(changePercent).toFixed(2)}% today`;
                
                cursor.textContent = isMarketPositive ? 'ü§î' : 'üòü';
            } catch (error) {
                answer.textContent = 'Market Closed üò¥';
                marketInfo.textContent = 'Unable to fetch market data';
            }
        }

        async function checkTicker(ticker) {
            if (!ticker || !ticker.trim()) {
                reallyHappyAnswer.textContent = '';
                return;
            }
            
            reallyHappyAnswer.textContent = 'Loading...';
            reallyHappyAnswer.style.color = '#666';
            
            try {
                // Using Yahoo Finance API (free, no API key needed)
                const symbol = ticker.toUpperCase();
                const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=2d`);
                const data = await response.json();
                
                if (!data.chart || !data.chart.result || data.chart.result.length === 0) {
                    reallyHappyAnswer.textContent = 'Invalid ticker';
                    reallyHappyAnswer.style.color = '#ef4444';
                    return;
                }
                
                const result = data.chart.result[0];
                const currentPrice = result.meta.regularMarketPrice;
                const previousClose = result.meta.previousClose;
                
                if (!currentPrice || !previousClose) {
                    reallyHappyAnswer.textContent = 'Invalid ticker';
                    reallyHappyAnswer.style.color = '#ef4444';
                    return;
                }
                
                const changePercent = ((currentPrice - previousClose) / previousClose) * 100;
                const isPositive = changePercent >= 0;
                
                reallyHappyAnswer.textContent = isPositive ? 'YES üòä' : 'NO üòü';
                reallyHappyAnswer.style.color = isPositive ? '#22c55e' : '#ef4444';
            } catch (error) {
                reallyHappyAnswer.textContent = 'Error fetching ticker';
                reallyHappyAnswer.style.color = '#ef4444';
            }
        }

        tickerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkTicker(tickerInput.value.trim());
            }
        });

        function createSimulatedCursor() {
            const id = Date.now();
            const element = document.createElement('div');
            element.className = 'other-cursor';
            element.textContent = isMarketPositive ? 'ü§î' : 'üòü';
            document.body.appendChild(element);

            const cursor = {
                element,
                x: Math.random() * window.innerWidth,
                y: Math.random() * window.innerHeight
            };

            otherCursors.set(id, cursor);

            let lastFrame = performance.now();
            function animate(currentTime) {
                const deltaTime = currentTime - lastFrame;
                lastFrame = currentTime;

                const speed = 0.1 * deltaTime;
                cursor.x += (Math.random() - 0.5) * speed;
                cursor.y += (Math.random() - 0.5) * speed;

                cursor.x = Math.max(0, Math.min(window.innerWidth, cursor.x));
                cursor.y = Math.max(0, Math.min(window.innerHeight, cursor.y));

                element.style.left = cursor.x + 'px';
                element.style.top = cursor.y + 'px';

                requestAnimationFrame(animate);
            }

            requestAnimationFrame(animate);
        }

        checkMarket();
        setInterval(checkMarket, 60000);

        for (let i = 0; i < 3; i++) {
            setTimeout(createSimulatedCursor, i * 1000);
        }
    </script>
</body>
</html>